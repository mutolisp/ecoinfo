[
  {
    "objectID": "R_function.html",
    "href": "R_function.html",
    "title": "8  自定函式",
    "section": "",
    "text": "R 和其他語言一樣，可以自行定義函式(function)，在基本操作的章節裡頭我們曾提過使用 R 內建的函式。當你需要重複處理一些程序時，自己撰寫函式就可以反覆使用程式碼，不需要每次都得執行落落長的 R 程式。舉例來說，當計算 Shannon-Wiener 多樣性指數時，我們用 R 來計算會怎麼做呢？\nShannon-Wiener 多樣性指數的公式如下：\n\\[\nH' = - \\sum_{i=1}^{S} P_i \\cdot ln (P_i)\n\\]\n其中 S 是一地的總物種數， \\(P_i\\) 則是第 \\(i\\) 個物種之數量佔總物種數量的比例\n若臺灣某森林樣區裡頭木本植物的數量如下表所示，其中第一個欄位是物種名(species)，第二個欄位則是該物種在樣區裡頭的數量(individuals)：\n原始的資料可至github 生態資訊學上課資料中下載。\n所以若要計算這個樣區的 Shannon-Wiener 多樣性指數，R 的 code 如下：\n本範例 code 下載\n可是每次有一個新的資料進來，計算就得要重新執行一次 (也就是執行上面的程式碼)，此時就可以把上面的步驟包裝成一個函式，簡化工作。試著想想：如果有個函式叫做 shannon()，每當我們想要計算 Shannon-Wiener 多樣性指數的時候，就呼叫它計算，這樣是不是很方便呢？接下來我們將針對函式的結構及撰寫來做介紹。"
  },
  {
    "objectID": "R_function.html#函式結構",
    "href": "R_function.html#函式結構",
    "title": "8  自定函式",
    "section": "1 函式結構",
    "text": "1 函式結構\n一般 R 函式的結構如下：\nmyFunction <- function(參數1, 參數2, ...){\n    陳述(statements)\n    return(objects)\n}\nfunction(){} 括號內的是參數(parameters)，大括號則是你想執行的程式碼(statement)，如果你希望這個函式計算完之後能回傳(return)一些東西(數值或物件等)，也可以在函式內的最後一行加上return(你要傳回的物件)。\n範例一、Hello World\n\n### 生態資訊學範例\n\nhelloWorld <- function(){\n    print('Hello World!')\n}\n\nhelloWorld()\n\n[1] \"Hello World!\"\n\n\n本範例 code 下載\n在這個範例中，自訂的函式沒有參數，內容只有印出「Hello World!」\n範例二、加入參數的函式\n我們稍微改一下上面 Hello World 的範例，加上參數\n\n### 生態資訊學範例: function\n\nhelloWorld <- function(username){\n  sprintf('Hello! %s', username)\n}\n\nhelloWorld('小熊維尼')\n\n[1] \"Hello! 小熊維尼\"\n\n\n本範例 code 下載\n這個例子中，我們用到 sprintf 這個 C 類型的字串格式化函式，裡頭的 %s 代表變數(s 代表 string)，變數的內容是 username。所以當使用者輸入 helloWorld('小熊維尼') 時，這個函式就會印出 “Hello! 小熊維尼”。\n範例三、設定參數的預設值\n你可能會想問，參數是否可以有預設值呢？答案是可以的！只要在參數後方加上=value，這個 value 就是該參數的預設值，舉例來說：\n\n### 生態資訊學範例: function\n\nhelloWorld <- function(username='小熊維尼'){\n  sprintf('Hello! %s', username)\n}\n\nhelloWorld()\n\n[1] \"Hello! 小熊維尼\"\n\n\n本範例 code 下載\n若這個函式內有預設值的話，即使呼叫函數沒有加上參數也能夠執行，所以上面的執行結果也會印出 “Hello! 小熊維尼”。\n範例四、Shannon-Wiener 多樣性指數計算\n回到本節最前面的實例，如果我們要把 Shannon-Wiener 多樣性指數包成一個函式該怎麼做呢？以本例來說流程可以切為三個步驟：\n\n分析這個函式需要輸入什麼參數？\n內容該如何計算？\n需要輸出哪些東西？\n\n在第一個步驟中，我們需要有物種和其個體數的資料，資料格式共有兩個欄位。接下來第二步驟就是先算出總物種個體數，以及個別物種的個體數佔總物種數的比例。最後則是把計算出來的數值輸出，所以函式可以這樣寫：\n\nShannonWiener <- function(filePath) {\n  twforest <- fread(filePath)\n  # 計算總物種數\n  S <- twforest[, sum(individuals) ]\n  # 計算個別物種數佔總物種數之比例\n  p_i <- twforest[, individuals/S ]\n  # 最後加總並算出 Shannon-Wiener (H') 多樣性指數\n  H <- -sum(p_i * log(p_i))\n  return(H)\n}\n\n本範例 code 下載\n在第一行內，filePath是我們要輸入的參數，也就是輸入的檔案路徑。所以在第二行就使用 fread() 來讀取這個參數。之後的4–8行和我們之前的程式碼相同。第九行則是傳回 H 這個變數，也就是計算完的 Shannon-Wiener 多樣性指數。"
  },
  {
    "objectID": "R_function.html#分享你的函式",
    "href": "R_function.html#分享你的函式",
    "title": "8  自定函式",
    "section": "2 分享你的函式",
    "text": "2 分享你的函式\n當撰寫完你的函式之後，如果你想和別人分享，可以把它包成套件(package)上傳 CRAN 或是 github 和其他人分享。但包套件是比較複雜的程序，需要有許多先備知識，未來進階的課程內容有機會會提到。這節將使用 http://gist.github.com (簡稱 gist )來分享你的函式。gist 是一個貼程式碼的網站(像剪貼簿一樣)，你可以直接把上面的程式碼複製貼上(請記得先登入，這樣以後就可以管理你的程式碼)。如下圖：\n\n接下來你會在瀏覽器的網址列看到這段函式的網址列(即：https://gist.github.com/mutolisp/643dc4795d0b31f1ef3fdaca1641fa7e)。請先複製起來等會會用到。回到 RStudio 中，請確認一下已經安裝了 devtools 套件。\n載入 devtools 之後，就可以使用 source_gist() 來載入剛剛你貼到 gist 的 R function。第一個參數是看起來像亂碼的 hash code，以本例來說就是 643dc4795d0b31f1ef3fdaca1641fa7e，後面的 filename 則是你自行命名的 filename，在這裡則是 ShannonWiener.r\n\n\nlibrary(devtools)\n\nLoading required package: usethis\n\nsource_gist('643dc4795d0b31f1ef3fdaca1641fa7e', filename = 'ShannonWiener.r')\n\nℹ Sourcing https://gist.githubusercontent.com/mutolisp/643dc4795d0b31f1ef3fdaca1641fa7e/raw/9b4b87c76be8addbfdfe4d0942488425a8ec18d4/ShannonWiener.r\n\n\nℹ SHA-1 hash of file is 7f2f82fb8a53d941030907fa7aa43d8ab0431ed4\n\nShannonWiener('https://raw.githubusercontent.com/mutolisp/ecoinformatics_course/master/data/twforest.csv')\n\n[1] 2.827801\n\n\n本範例 code 下載\n當使用 source_gist() 後你就直接可以用 ShannonWiener 函式了！"
  },
  {
    "objectID": "R_function.html#作業",
    "href": "R_function.html#作業",
    "title": "8  自定函式",
    "section": "3 作業",
    "text": "3 作業\n\n請寫出一個可計算 Shannon-Wiener 多樣性指數和Simpson 多樣性指數(包含 Simpson index, Simpson diversity index, inverse Simpson)的函式，函式必須加入可讓使用者選擇多樣性指數的參數\n請寫出一個可計算費布納西(fibonacci)數列的函式`"
  }
]